<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í¬ë¥´íˆ¬ê°ˆ ì—¬í–‰ ê°€ì´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals (Beige, Warm Gray, Terracotta Accent) -->
    <!-- Application Structure Plan: The application is structured as a tabbed, single-page application (SPA) to provide a non-linear, task-oriented user experience. Instead of forcing the user to scroll through a long document, this structure allows them to instantly access the information they need, whether it's the daily itinerary, pre-trip preparations, or specific recommendations. The main sections are 'Itinerary Overview', 'Key Preparations', 'Recommendations', and 'Travel Tips'. This is more intuitive for a traveler who might need different information at different stages of their journey (planning vs. on-the-ground). The itinerary uses expandable cards to manage information density, while preparations use accordions. Recommendations are filterable, empowering the user to quickly find relevant options. This design prioritizes ease of use and quick information retrieval, which is ideal for the target user. -->
    <!-- Visualization & Content Choices: 
        - Itinerary (Table to Interactive Cards): Goal: Organize/Inform. Method: HTML/Tailwind cards with JS for click-to-expand. Justification: More engaging and less overwhelming than a large table. Shows high-level info first, with details on demand.
        - Weather Comparison (Text to Bar Chart): Goal: Compare. Method: Chart.js Bar Chart. Justification: Visually represents the temperature difference between key cities far more effectively than text, reinforcing the packing advice.
        - Driving Time (Text to Bar Chart): Goal: Compare. Method: Chart.js Bar Chart. Justification: Clearly illustrates the estimated driving times between cities for the road trip portion of the journey.
        - City Card Analysis (Text to Donut Charts): Goal: Compare/Inform. Method: Chart.js Donut Charts. Justification: Provides a compelling visual breakdown of costs vs. benefits for city passes, aiding in economic decision-making.
        - Recommendations (List to Filterable Gallery): Goal: Organize/Inform. Method: HTML/Tailwind cards with JS filtering. Justification: Allows the user to dynamically narrow down options by city and type (food/stay), which is significantly more functional than a static list.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #FDFBF5; }
        .tab-active { border-color: #D97706; color: #D97706; background-color: #FFFBEB; }
        .tab-inactive { border-color: transparent; color: #57534E; }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-in-out; }
        .recommendation-card { display: block; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 300px; max-height: 400px; }
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        .gemini-btn {
            background: linear-gradient(45deg, #f9a8d4, #f472b6);
            transition: all 0.3s ease;
        }
        .gemini-btn:hover {
            box-shadow: 0 0 15px rgba(244, 114, 182, 0.5);
        }
        .loader {
            width: 24px;
            height: 24px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #f472b6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: none; /* Initially hidden */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-5xl font-bold text-amber-700">í¬ë¥´íˆ¬ê°ˆ ì—¬í–‰ ê°€ì´ë“œ</h1>
            <p class="text-lg md:text-xl text-stone-600 mt-2">ììœ ë¡œìš´ ë Œí„°ì¹´ ì—¬í–‰ê³¼ í•¨ê»˜í•˜ëŠ” ì§€ëŠ¥í˜• ê°€ì´ë“œ</p>
        </header>

        <nav class="flex flex-wrap justify-center border-b-2 border-stone-200 mb-8">
            <button data-target="itinerary" class="tab-btn text-sm md:text-base font-semibold py-3 px-4 md:px-6 border-b-2 transition-colors duration-300 tab-active">ğŸ—“ï¸ ì—¬ì • í•œëˆˆì— ë³´ê¸°</button>
            <button data-target="prep" class="tab-btn text-sm md:text-base font-semibold py-3 px-4 md:px-6 border-b-2 transition-colors duration-300 tab-inactive">ğŸ“‹ í•µì‹¬ ì¤€ë¹„ì‚¬í•­</button>
            <button data-target="recommend" class="tab-btn text-sm md:text-base font-semibold py-3 px-4 md:px-6 border-b-2 transition-colors duration-300 tab-inactive">ğŸ¨ ë§›ì§‘ & ìˆ™ì†Œ</button>
            <button data-target="tips" class="tab-btn text-sm md:text-base font-semibold py-3 px-4 md:px-6 border-b-2 transition-colors duration-300 tab-inactive">ğŸ’¡ ì—¬í–‰ íŒ & ë¶„ì„</button>
        </nav>

        <main>
            <section id="itinerary" class="content-section active">
                <div class="text-center mb-8 p-4 bg-amber-50 rounded-lg">
                    <h2 class="text-2xl font-bold text-amber-800 mb-2">9ë°• 10ì¼ ì—¬ì • ê³„íš</h2>
                    <p class="text-stone-700">ë¦¬ìŠ¤ë³¸ì—ì„œ ì‹œì‘í•˜ì—¬ ì•„ë² ì´ë£¨, í¬ë¥´íˆ¬ë¥¼ ê±°ì³ ìŠ¤í˜ì¸ ë¹Œë°”ì˜¤ì—ì„œ ë§ˆë¬´ë¦¬ë˜ëŠ” ì—¬ì •ì…ë‹ˆë‹¤. ê° ë‚ ì§œ ì¹´ë“œë¥¼ í´ë¦­í•˜ì—¬ ìƒì„¸ ê³„íšê³¼ AI ì¶”ì²œ í™œë™ì„ í™•ì¸í•´ ë³´ì„¸ìš”.</p>
                </div>
                <div id="itinerary-container" class="space-y-4"></div>
            </section>

            <section id="prep" class="content-section">
                 <div class="text-center mb-8 p-4 bg-amber-50 rounded-lg">
                    <h2 class="text-2xl font-bold text-amber-800 mb-2">ì—¬í–‰ ì „ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
                    <p class="text-stone-700">ì„±ê³µì ì¸ ì—¬í–‰ì„ ìœ„í•´ ê¼­ í•„ìš”í•œ ì‹¤ìš©ì ì¸ ì •ë³´ë“¤ì„ ëª¨ì•˜ìŠµë‹ˆë‹¤. ë‚ ì”¨ë¶€í„° êµí†µ, ì•ˆì „ ìˆ˜ì¹™ê¹Œì§€ ê¼¼ê¼¼íˆ í™•ì¸í•˜ì—¬ ì™„ë²½í•œ ì—¬ì •ì„ ì¤€ë¹„í•˜ì„¸ìš”.</p>
                </div>
                <div id="prep-accordion-container" class="space-y-3"></div>
            </section>

            <section id="recommend" class="content-section">
                <div class="text-center mb-8 p-4 bg-amber-50 rounded-lg">
                    <h2 class="text-2xl font-bold text-amber-800 mb-2">ì—„ì„ ëœ ì¶”ì²œ ëª©ë¡</h2>
                    <p class="text-stone-700">ìµœê³ ì˜ ë¯¸ì‹ ê²½í—˜ê³¼ í¸ì•ˆí•œ íœ´ì‹ì„ ìœ„í•´ ì—„ì„ í•œ ë§›ì§‘ê³¼ ìˆ™ì†Œ ëª©ë¡ì…ë‹ˆë‹¤. ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ë„ì‹œì™€ ì¢…ë¥˜ë¥¼ ì„ íƒí•˜ì—¬ ì›í•˜ëŠ” ì •ë³´ë¥¼ ì‰½ê²Œ ì°¾ì•„ë³´ì„¸ìš”.</p>
                </div>
                <!-- Gemini Culinary Explorer -->
                <div class="bg-white p-6 rounded-lg shadow-md mb-8 border-l-4 border-pink-500">
                    <h3 class="text-xl font-bold text-pink-700 mb-3">âœ¨ AI ì‹¤ì‹œê°„ ë§›ì§‘ ê²€ìƒ‰</h3>
                    <p class="text-sm text-stone-600 mb-4">ì°¾ê³  ì‹¶ì€ ìŒì‹ ì¢…ë¥˜ë‚˜ ì‹ë‹¹ ì´ë¦„ì„ ì…ë ¥í•´ ë³´ì„¸ìš”. AIê°€ í˜„ì§€ì—ì„œ ì‹¤ì œ ìš´ì˜ ì¤‘ì¸ ë§›ì§‘ì„ ì°¾ì•„ ì¶”ì²œí•´ ë“œë¦½ë‹ˆë‹¤.</p>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input type="text" id="food-preference-input" placeholder="ì˜ˆ: ë¦¬ìŠ¤ë³¸ í•´ë¬¼ë°¥ ë§›ì§‘, ë¹Œë°”ì˜¤ í•œì‹ë‹¹" class="flex-grow p-2 border border-stone-300 rounded-md focus:ring-2 focus:ring-pink-400 focus:border-transparent">
                        <button id="get-food-recommendation-btn" class="gemini-btn text-white font-bold py-2 px-4 rounded-md flex items-center justify-center">
                            <span>ë§›ì§‘ ê²€ìƒ‰í•˜ê¸°</span>
                            <div class="loader ml-2"></div>
                        </button>
                    </div>
                    <div id="food-recommendation-output" class="mt-4 p-4 bg-pink-50 rounded-lg prose prose-sm max-w-none hidden"></div>
                </div>

                <div class="flex justify-center flex-wrap gap-2 mb-8">
                    <button class="filter-btn bg-amber-600 text-white py-2 px-4 rounded-full" data-filter="all">ì „ì²´ ë³´ê¸°</button>
                    <button class="filter-btn bg-white border border-amber-600 text-amber-700 py-2 px-4 rounded-full" data-filter="lisbon-food">ë¦¬ìŠ¤ë³¸ ë§›ì§‘</button>
                    <button class="filter-btn bg-white border border-amber-600 text-amber-700 py-2 px-4 rounded-full" data-filter="lisbon-stay">ë¦¬ìŠ¤ë³¸ ìˆ™ì†Œ</button>
                    <button class="filter-btn bg-white border border-green-600 text-green-700 py-2 px-4 rounded-full" data-filter="aveiro-all">ì•„ë² ì´ë£¨</button>
                    <button class="filter-btn bg-white border border-blue-600 text-blue-700 py-2 px-4 rounded-full" data-filter="porto-food">í¬ë¥´íˆ¬ ë§›ì§‘</button>
                    <button class="filter-btn bg-white border border-blue-600 text-blue-700 py-2 px-4 rounded-full" data-filter="porto-stay">í¬ë¥´íˆ¬ ìˆ™ì†Œ</button>
                    <button class="filter-btn bg-white border border-red-600 text-red-700 py-2 px-4 rounded-full" data-filter="bilbao-food">ë¹Œë°”ì˜¤ ë§›ì§‘</button>
                    <button class="filter-btn bg-white border border-red-600 text-red-700 py-2 px-4 rounded-full" data-filter="bilbao-stay">ë¹Œë°”ì˜¤ ìˆ™ì†Œ</button>
                </div>
                <div id="recommend-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </section>
            
            <section id="tips" class="content-section">
                <div class="text-center mb-8 p-4 bg-amber-50 rounded-lg">
                    <h2 class="text-2xl font-bold text-amber-800 mb-2">ì—¬í–‰ ì „ë¬¸ê°€ì˜ ì‹¬ì¸µ ë¶„ì„</h2>
                    <p class="text-stone-700">ë”ìš± ê²½ì œì ì´ê³  ê¹Šì´ ìˆëŠ” ì—¬í–‰ì„ ìœ„í•œ ì „ë¬¸ê°€ì˜ ë¶„ì„ ì •ë³´ì…ë‹ˆë‹¤. ê° ë„ì‹œì˜ ì—¬í–‰ì ì¹´ë“œ êµ¬ë§¤ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ëŠ” ë° ë„ì›€ì„ ë“œë¦½ë‹ˆë‹¤.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold text-center mb-4 text-amber-700">ë¦¬ìŠ¤ë³¸ ì¹´ë“œ ë¶„ì„</h3>
                        <div class="chart-container h-64 md:h-72"><canvas id="lisbonCardChart"></canvas></div>
                        <p class="mt-4 text-sm text-stone-600">
                            <b>ê²°ë¡ : í¸ì˜ì„±ì„ ê³ ë ¤í•˜ë©´ êµ¬ë§¤ ê°€ì¹˜ ìˆìŒ.</b><br>
                            ìˆœìˆ˜ ë¹„ìš© ì ˆê° íš¨ê³¼ëŠ” í¬ì§€ ì•Šìœ¼ë‚˜, ë§¤ë²ˆ í‘œë¥¼ êµ¬ë§¤í•˜ëŠ” ë²ˆê±°ë¡œì›€ ì—†ì´ ëŒ€ì¤‘êµí†µì„ ì´ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ í° ì¥ì ì…ë‹ˆë‹¤.
                        </p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold text-center mb-4 text-blue-700">í¬ë¥´íˆ¬ ì¹´ë“œ ë¶„ì„</h3>
                        <div class="chart-container h-64 md:h-72"><canvas id="portoCardChart"></canvas></div>
                        <p class="mt-4 text-sm text-stone-600">
                           <b>ê²°ë¡ : êµ¬ë§¤ ë¹„ì¶”ì²œ.</b><br>
                           í•µì‹¬ ëª…ì†Œ í• ì¸ì´ ì ì–´ ëŒ€ì¤‘êµí†µ ì „ìš© 'ì•ˆë‹¨í…Œ íˆ¬ì–´ ì¹´ë“œ'ë¥¼ êµ¬ë§¤í•˜ê³ , ì…ì¥ê¶Œì€ ê°œë³„ êµ¬ë§¤í•˜ëŠ” ê²ƒì´ ë” ê²½ì œì ì…ë‹ˆë‹¤.
                        </p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold text-center mb-4 text-red-700">ë¹Œë°”ì˜¤ ì¹´ë“œ ë¶„ì„</h3>
                        <div class="chart-container h-64 md:h-72"><canvas id="bilbaoCardChart"></canvas></div>
                        <p class="mt-4 text-sm text-stone-600">
                           <b>ê²°ë¡ : êµ¬ê²í•˜ì„ ë°©ë¬¸ ì‹œ ì¶”ì²œ.</b><br>
                           êµí†µí¸ê³¼ í•¨ê»˜ êµ¬ê²í•˜ì„ ë¯¸ìˆ ê´€ ì…ì¥ê¶Œì´ í¬í•¨ë˜ì–´ ìˆì–´ ë§¤ìš° í¸ë¦¬í•©ë‹ˆë‹¤. ë¯¸ìˆ ê´€ ë°©ë¬¸ ê³„íšì´ ìˆë‹¤ë©´ êµ¬ë§¤ë¥¼ ì ê·¹ ì¶”ì²œí•©ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            </section>
        </main>

    </div>

    <script>
        const appData = {
            itinerary: [
                { day: 1, city: 'ë¦¬ìŠ¤ë³¸', cityForPrompt: 'Lisbon', theme: 'ë„ì°© ë° ë°”ì´ìƒ¤ ì§€êµ¬ ì‚°ì±…', details: `ê³µí•­ ë„ì°© í›„ íƒì‹œ/ìš°ë²„ ë˜ëŠ” ê³µí•­ë²„ìŠ¤(Aerobus)ë¥¼ ì´ìš©í•´ ìˆ™ì†Œë¡œ ì´ë™í•©ë‹ˆë‹¤. ê¸´ ë¹„í–‰ í›„ì˜ í”¼ë¡œë¥¼ ê³ ë ¤í•˜ì—¬ ëŒ€ì¤‘êµí†µë³´ë‹¤ëŠ” í¸ì•ˆí•œ ì´ë™ì„ ì¶”ì²œí•©ë‹ˆë‹¤. ìˆ™ì†Œì— ì§ì„ í‘¼ ë’¤, ë°”ì´ìƒ¤ ì§€êµ¬ë¥¼ ì‚°ì±…í•˜ë©° ë¦¬ìŠ¤ë³¸ì˜ ì²«ì¸ìƒì„ ëŠê»´ë³´ì„¸ìš”.` },
                { day: 2, city: 'ë¦¬ìŠ¤ë³¸', cityForPrompt: 'Lisbon', theme: 'ë²¨ë  ì§€êµ¬ì™€ ëŒ€í•­í•´ì‹œëŒ€ì˜ í™©ê¸ˆê¸°', details: `ëŒ€ì¤‘êµí†µì„ ì´ìš©í•˜ê±°ë‚˜, ì£¼ì°¨ì˜ í¸ì˜ì„±ì„ ê³ ë ¤í•´ ìš°ë²„/íƒì‹œë¡œ ë²¨ë  ì§€êµ¬ë¡œ ì´ë™í•©ë‹ˆë‹¤. ì œë¡œë‹ˆë¬´ìŠ¤ ìˆ˜ë„ì›(ì˜¨ë¼ì¸ ì˜ˆë§¤ í•„ìˆ˜) ë°©ë¬¸ í›„, ì›ì¡° ì—ê·¸íƒ€ë¥´íŠ¸ ë§›ì§‘ íŒŒìŠ¤í…Œì´ìŠ¤ ë“œ ë²¨ë ì„ ë§›ë´…ë‹ˆë‹¤.` },
                { day: 3, city: 'ë¦¬ìŠ¤ë³¸', cityForPrompt: 'Lisbon', theme: 'ì•ŒíŒŒë§ˆì˜ ì˜í˜¼, ë¯¸ë¡œì™€ íŒŒë‘', details: `ì•ŒíŒŒë§ˆ ì§€êµ¬ëŠ” ê¸¸ì´ ì¢ê³  ë³µì¡í•˜ë¯€ë¡œ ë„ë³´ë‚˜ ëŒ€ì¤‘êµí†µ ì´ìš©ì„ ì¶”ì²œí•©ë‹ˆë‹¤. ìƒ ì¡°ë¥´ì œ ì„±ê³¼ ì „ë§ëŒ€ë“¤ì„ ë‘˜ëŸ¬ë³¸ í›„, ì €ë…ì—ëŠ” ì˜ˆì•½í•œ íŒŒë‘ í•˜ìš°ìŠ¤ì—ì„œ ê³µì—°ê³¼ ì‹ì‚¬ë¥¼ ì¦ê¹ë‹ˆë‹¤.` },
                { day: 4, city: 'ë¦¬ìŠ¤ë³¸ > ì•„ë² ì´ë£¨', cityForPrompt: 'Aveiro', theme: 'í¬ë¥´íˆ¬ê°ˆì˜ ë² ë„¤ì¹˜ì•„ë¡œ ë“œë¼ì´ë¸Œ', details: `ì˜¤ì „ì— ë¦¬ìŠ¤ë³¸ ì‹œë‚´(ë˜ëŠ” í¸ì˜ì— ë”°ë¼ ê³µí•­)ì—ì„œ ë Œí„°ì¹´ë¥¼ ìˆ˜ë ¹í•˜ì—¬ ì•„ë² ì´ë£¨ë¡œ ì´ë™í•©ë‹ˆë‹¤ (ì•½ 2.5ì‹œê°„ ì†Œìš”). 'ë¹„ì•„ ë² ë¥´ë°' ì¥ì¹˜ ë¶€ì°© ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³ , ë³¸ê²©ì ì¸ ìë™ì°¨ ì—¬í–‰ì„ ì‹œì‘í•©ë‹ˆë‹¤. ë„ì°© í›„ ìš´í•˜ì—ì„œ ëª°ë¦¬ì„¸ì´ë£¨ ë°°ë¥¼ íƒ€ë©° ë‚­ë§Œì ì¸ ì˜¤í›„ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.` },
                { day: 5, city: 'ì•„ë² ì´ë£¨ > í¬ë¥´íˆ¬', cityForPrompt: 'Porto', theme: 'ì¤„ë¬´ëŠ¬ ë§ˆì„ê³¼ í¬ë¥´íˆ¬ì˜ ì²« ë§Œë‚¨', details: `ì˜¤ì „ì— ì½”ìŠ¤íƒ€ ë…¸ë°”ì˜ ë‹¤ì±„ë¡œìš´ ì¤„ë¬´ëŠ¬ ì§‘ë“¤ì„ êµ¬ê²½í•©ë‹ˆë‹¤. ì˜¤í›„ì— í¬ë¥´íˆ¬ë¡œ ì´ë™í•˜ì—¬ (ì•½ 1ì‹œê°„ ì†Œìš”) ìˆ™ì†Œì— ì£¼ì°¨í•©ë‹ˆë‹¤. ì €ë…ì—ëŠ” íˆë² ì´ë¼ ì§€êµ¬ë¥¼ ì‚°ì±…í•˜ë©° ë™ ë£¨ì´ìŠ¤ 1ì„¸ ë‹¤ë¦¬ì˜ ì•¼ê²½ì„ ê°ìƒí•©ë‹ˆë‹¤.` },
                { day: 6, city: 'í¬ë¥´íˆ¬', cityForPrompt: 'Porto', theme: 'í¬ë¥´íˆ¬ì˜ ì‹¬ì¥ë¶€ íƒë°©', details: `ì‹œë‚´ëŠ” ì£¼ì°¨ê°€ ì–´ë µê³  ë„ë³´ ì´ë™ì´ í¸ë¦¬í•©ë‹ˆë‹¤. ìˆ™ì†Œì— ì°¨ë¥¼ ë‘ê³  ìƒ ë²¤íˆ¬ ê¸°ì°¨ì—­, ë ë£¨ ì„œì (ì˜¨ë¼ì¸ ì˜ˆë§¤ í•„ìˆ˜), í´ë ˆë¦¬êµ¬ìŠ¤ íƒ‘ ë“±ì„ ë‘˜ëŸ¬ë´…ë‹ˆë‹¤. ì˜¤í›„ì—ëŠ” ê°€ì´ì•„ ì§€êµ¬ë¡œ ë„˜ì–´ê°€ ë…¸ì„ì„ ê°ìƒí•©ë‹ˆë‹¤.` },
                { day: 7, city: 'í¬ë¥´íˆ¬', cityForPrompt: 'Porto', theme: 'ë„ë£¨ ê°•ë³€ì˜ í–¥ê¸°, í¬íŠ¸ ì™€ì¸ ì²´í—˜', details: `ë„ë³´ë‚˜ ëŒ€ì¤‘êµí†µìœ¼ë¡œ ë¹Œë¼ ë…¸ë°” ë“œ ê°€ì´ì•„ì˜ ì™€ì´ë„ˆë¦¬ë¥¼ ë°©ë¬¸í•˜ì—¬ íˆ¬ì–´ì™€ í…Œì´ìŠ¤íŒ…ì„ ì¦ê¹ë‹ˆë‹¤. ì €ë…ì—ëŠ” í¬ë¥´íˆ¬ ëª…ë¬¼ ìš”ë¦¬ í”„ë€ì„¸ì§€ëƒì— ë„ì „í•©ë‹ˆë‹¤. ì´í›„ ë Œí„°ì¹´ë¥¼ í¬ë¥´íˆ¬ ê³µí•­ì— ë°˜ë‚©í•©ë‹ˆë‹¤.` },
                { day: 8, city: 'í¬ë¥´íˆ¬ > ë¹Œë°”ì˜¤', cityForPrompt: 'Bilbao', theme: 'ì˜ˆìˆ ì˜ ë„ì‹œë¡œ ì´ë™', details: `ì˜¤ì „ì— í¬ë¥´íˆ¬ ê³µí•­ìœ¼ë¡œ ì´ë™í•˜ì—¬ ë¹Œë°”ì˜¤í–‰ í•­ê³µí¸ì— íƒ‘ìŠ¹í•©ë‹ˆë‹¤ (ë¹„í–‰ì‹œê°„ ì•½ 1ì‹œê°„). ë¹Œë°”ì˜¤ ë„ì°© í›„ ìˆ™ì†Œ ì²´í¬ì¸, êµ¬ì‹œê°€ì§€(Casco Viejo)ë¥¼ ì‚°ì±…í•˜ë©° í•€ì´ˆ(Pintxos) ë°”ë¡œ ì €ë…ì„ í•´ê²°í•©ë‹ˆë‹¤.` },
                { day: 9, city: 'ë¹Œë°”ì˜¤', cityForPrompt: 'Bilbao', theme: 'êµ¬ê²í•˜ì„ê³¼ í˜„ëŒ€ ê±´ì¶•ì˜ ë¯¸í•™', details: `ì˜¤ì „ì—ëŠ” ë¹Œë°”ì˜¤ì˜ ìƒì§•, êµ¬ê²í•˜ì„ ë¯¸ìˆ ê´€ì„ ì§‘ì¤‘ì ìœ¼ë¡œ ê´€ëŒí•©ë‹ˆë‹¤. ì˜¤í›„ì—ëŠ” ë„¤ë¥´ë¹„ì˜¨ ê°•ë³€ì„ ë”°ë¼ ì‚°ì±…í•˜ë©° ìˆ˜ë¹„ìˆ˜ë¦¬ ë‹¤ë¦¬ ë“± í˜„ëŒ€ì ì¸ ê±´ì¶•ë¬¼ë“¤ì„ ê°ìƒí•©ë‹ˆë‹¤.` },
                { day: 10, city: 'ë¹Œë°”ì˜¤', cityForPrompt: 'Bilbao', theme: 'ì¶œêµ­', details: `ì˜¤ì „ì— ê°€ì¥ ë§ˆìŒì— ë“¤ì—ˆë˜ ì¥ì†Œë¥¼ ë‹¤ì‹œ ë°©ë¬¸í•˜ê±°ë‚˜ ê¸°ë…í’ˆ ì‡¼í•‘ì„ ì¦ê¹ë‹ˆë‹¤. ì˜¤í›„ì— ë¹Œë°”ì˜¤ ê³µí•­ìœ¼ë¡œ ì´ë™í•˜ì—¬ í•œêµ­ìœ¼ë¡œ ì¶œë°œí•©ë‹ˆë‹¤. Â¡Buen viaje!` },
            ],
            prep: [
                {
                    title: 'ğŸŒ¤ï¸ 9ì›” ë‚ ì”¨ì™€ ì˜·ì°¨ë¦¼',
                    content: `9ì›”ì€ ì—¬í–‰ ìµœì ê¸°ì…ë‹ˆë‹¤. ì „ë°˜ì ìœ¼ë¡œ ì¾Œì í•˜ì§€ë§Œ ë„ì‹œë³„ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤. <div class="my-4 p-4 border border-stone-200 rounded-lg bg-stone-50"><h4 class="font-bold">ë¦¬ìŠ¤ë³¸:</h4><p>ë‚® 20~28Â°Cë¡œ ë”°ìŠ¤í•˜ê³  ì¾Œì í•©ë‹ˆë‹¤. ì €ë…ì—ëŠ” ê¸°ì˜¨ì´ ë‚´ë ¤ê°€ë¯€ë¡œ ê°€ë²¼ìš´ ì™¸íˆ¬ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.</p></div><div class="p-4 border border-stone-200 rounded-lg bg-stone-50"><h4 class="font-bold">í¬ë¥´íˆ¬ & ë¹Œë°”ì˜¤:</h4><p>ë‚® 14~24Â°Cë¡œ ë¦¬ìŠ¤ë³¸ë³´ë‹¤ ì„œëŠ˜í•˜ë©° ì¼êµì°¨ê°€ í½ë‹ˆë‹¤. ê²¹ì³ ì…ì„ ìˆ˜ ìˆëŠ” ì˜·(ìŠ¤ì›¨í„°, ë°”ëŒë§‰ì´)ì„ ì¤€ë¹„í•˜ì„¸ìš”.</p></div><div class="mt-4"><h4 class="font-bold">í•µì‹¬ ì¤€ë¹„ë¬¼:</h4><ul class="list-disc list-inside"><li><b>ì‹ ë°œ:</b> ìš´ì „ ì™¸ì—ë„ ê±·ëŠ” ì‹œê°„ì´ ë§ìœ¼ë¯€ë¡œ, ë°œì´ í¸í•œ ìš´ë™í™”/ì›Œí‚¹í™”ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.</li><li><b>ì•¡ì„¸ì„œë¦¬:</b> í–‡ì‚´ì´ ê°•í•˜ë¯€ë¡œ ì„ í¬ë¦¼, ëª¨ì, ì„ ê¸€ë¼ìŠ¤ë¥¼ ê¼­ ì±™ê¸°ì„¸ìš”.</li></ul></div><div class="mt-6"><div class="chart-container"><canvas id="weatherChart"></canvas></div><p class="text-center text-xs text-stone-500 mt-1">í¬ë¥´íˆ¬ì™€ ë¹Œë°”ì˜¤ëŠ” ë¦¬ìŠ¤ë³¸ë³´ë‹¤ ì„œëŠ˜í•˜ë¯€ë¡œ ê²¹ì³ ì…ì„ ì˜·ì„ ì¤€ë¹„í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</p></div>`
                },
                {
                    title: 'ğŸš— êµí†µ (ë Œí„°ì¹´/í•­ê³µ)',
                    content: `ììœ ë¡œìš´ ì´ë™ì„ ìœ„í•œ ì •ë³´ì…ë‹ˆë‹¤. <div class="my-4 p-4 border border-stone-200 rounded-lg bg-stone-50"><h4 class="font-bold">ë Œí„°ì¹´ (ë¦¬ìŠ¤ë³¸-í¬ë¥´íˆ¬):</h4><p>ë¦¬ìŠ¤ë³¸ì—ì„œì˜ ì¼ì •ì„ ë§ˆì¹œ í›„ ì‹œë‚´ ì§€ì ì—ì„œ ë ŒíŠ¸í•˜ì—¬ í¬ë¥´íˆ¬ ê³µí•­ì—ì„œ ë°˜ë‚©í•˜ëŠ” í¸ë„ ë ŒíŠ¸ê°€ íš¨ìœ¨ì ì…ë‹ˆë‹¤. êµ­ì œìš´ì „ë©´í—ˆì¦ì€ í•„ìˆ˜ì´ë©°, ìë™ë³€ì†ê¸° ì°¨ëŸ‰ì€ ë¯¸ë¦¬ ì˜ˆì•½í•´ì•¼ í•©ë‹ˆë‹¤.</p></div><div class="my-4 p-4 border border-stone-200 rounded-lg bg-stone-50"><h4 class="font-bold">ê³ ì†ë„ë¡œ í†µí–‰ë£Œ (Via Verde):</h4><p>ë Œí„°ì¹´ ê³„ì•½ ì‹œ 'ë¹„ì•„ ë² ë¥´ë°(Via Verde)' ì „ì í†µí–‰ë£Œ ì¥ì¹˜ë¥¼ ì¶”ê°€í•˜ë©´, ìš”ê¸ˆì†Œì—ì„œ ë©ˆì¶œ í•„ìš” ì—†ì´ í•˜ì´íŒ¨ìŠ¤ì²˜ëŸ¼ í†µê³¼í•˜ê³  ë‚˜ì¤‘ì— í•œ ë²ˆì— ì •ì‚°í•  ìˆ˜ ìˆì–´ ë§¤ìš° í¸ë¦¬í•©ë‹ˆë‹¤.</p></div><div class="my-4 p-4 border border-stone-200 rounded-lg bg-stone-50"><h4 class="font-bold">ì£¼ì°¨:</h4><p>ë¦¬ìŠ¤ë³¸, í¬ë¥´íˆ¬ì˜ ì—­ì‚¬ ì§€êµ¬ëŠ” ì£¼ì°¨ê°€ ë§¤ìš° ì–´ë µê³  ë¹„ìŒ‰ë‹ˆë‹¤. ì£¼ì°¨ì¥ì´ ì œê³µë˜ëŠ” ìˆ™ì†Œë¥¼ ì˜ˆì•½í•˜ê±°ë‚˜, ì‹œ ì™¸ê³½ì— ì£¼ì°¨ í›„ ëŒ€ì¤‘êµí†µì„ ì´ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</p></div><div class="mt-6"><div class="chart-container"><canvas id="drivingTimeChart"></canvas></div><p class="text-center text-xs text-stone-500 mt-1">ë„ì‹œ ê°„ ì˜ˆìƒ ìš´ì „ ì‹œê°„ (íœ´ì‹ ì‹œê°„ ì œì™¸)</p></div><div class="mt-4 p-4 border border-stone-200 rounded-lg bg-stone-50"><h4 class="font-bold">í•­ê³µ (í¬ë¥´íˆ¬-ë¹Œë°”ì˜¤):</h4><p>í¬ë¥´íˆ¬ì—ì„œ ë¹Œë°”ì˜¤ êµ¬ê°„ì€ ì €ê°€ í•­ê³µì‚¬(ì˜ˆ: Vueling, Volotea)ë¥¼ ì´ìš©í•˜ë©´ 1ì‹œê°„ ë‚´ì™¸ë¡œ ë¹ ë¥´ê³  ê²½ì œì ìœ¼ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></div>`
                },
                {
                    title: 'ğŸ’¡ ì•ˆì „ ë° ê¸°íƒ€ íŒ',
                    content: `ì•ˆì „í•˜ê³  ì¦ê±°ìš´ ì—¬í–‰ì„ ìœ„í•œ ì „ë¬¸ê°€ì˜ ì¡°ì–¸ì…ë‹ˆë‹¤. <div class="my-4 p-4 border border-stone-200 rounded-lg bg-stone-50"><h4 class="font-bold">ì°¨ëŸ‰ ë‚´ ì†Œì§€í’ˆ:</h4><p>ì£¼ì°¨ ì‹œ, ê·€ì¤‘í’ˆì€ ë¬¼ë¡  ê°€ë°© ë“± ì–´ë–¤ ì§ë„ ì°¨ ì•ˆì— ë³´ì´ê²Œ ë‘ì§€ ë§ˆì„¸ìš”. ì°¨ëŸ‰í„¸ì´ì˜ í‘œì ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></div><div class="my-4 p-4 border border-stone-200 rounded-lg bg-stone-50"><h4 class="font-bold">í™”í ë° ê²°ì œ:</h4><p>ìœ ë¡œ(â‚¬)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ ì¹´ë“œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ì‘ì€ ìƒì ì´ë‚˜ í•€ì´ˆ ë°”ë¥¼ ìœ„í•´ ì†Œì•¡ì˜ í˜„ê¸ˆì„ ì¤€ë¹„í•˜ì„¸ìš”.</p></div><div class="my-4 p-4 border border-stone-200 rounded-lg bg-stone-50"><h4 class="font-bold">ì‹ë‹¹ ë¬¸í™”:</h4><p>í¬ë¥´íˆ¬ê°ˆì˜ ì¿ ë² ë¥´(ìœ ë£Œ ì‹ì „ë¹µ)ì™€ ìŠ¤í˜ì¸ì˜ í•€ì´ˆ(ì‘ì€ íƒ€íŒŒìŠ¤) ë¬¸í™”ë¥¼ ê²½í—˜í•´ë³´ì„¸ìš”.</p></div>`
                }
            ],
            recommendations: [
                { id: 1, city: 'lisbon', type: 'food', name: 'Cervejaria Ramiro', desc: `ì•¤ì„œë‹ˆ ë³´ë”˜ë„ ê·¹ì°¬í•œ ìµœê³ ì˜ í•´ì‚°ë¬¼ ì‹ë‹¹. ì˜ˆì•½ í•„ìˆ˜.`, note: 'í•´ì‚°ë¬¼' },
                { id: 2, city: 'lisbon', type: 'stay', name: 'Hotel da Baixa', desc: `ë°”ì´ìƒ¤ ì¤‘ì‹¬ ìœ„ì¹˜. ì£¼ì°¨ëŠ” ì¸ê·¼ ê³µì˜ì£¼ì°¨ì¥ ì´ìš©.`, note: '4ì„±ê¸‰ / ìœ„ì¹˜' },
                { id: 3, city: 'aveiro', type: 'food', name: 'MarÃ© Cheia', desc: `ì‹ ì„ í•œ í•´ì‚°ë¬¼ ìŠ¤íŠœ(Caldeirada)ê°€ ì¼í’ˆì¸ í˜„ì§€ ë§›ì§‘.`, note: 'í•´ì‚°ë¬¼' },
                { id: 4, city: 'aveiro', type: 'stay', name: 'Hotel Moliceiro', desc: `ì¤‘ì•™ ìš´í•˜ ë°”ë¡œ ì•ì— ìœ„ì¹˜í•œ ë¡œë§¨í‹±í•œ 4ì„±ê¸‰ í˜¸í…”. ì£¼ì°¨ ê°€ëŠ¥.`, note: '4ì„±ê¸‰ / ì „ë§' },
                { id: 5, city: 'porto', type: 'food', name: 'Tapabento', desc: `ì°½ì˜ì ì¸ í•´ì‚°ë¬¼ ìš”ë¦¬. ì˜ˆì•½ì´ ë§¤ìš° ì–´ë µì§€ë§Œ ê°•ë ¥ ì¶”ì²œ.`, note: 'í•´ì‚°ë¬¼/í˜„ëŒ€' },
                { id: 6, city: 'porto', type: 'stay', name: 'Pestana Vintage Porto', desc: `íˆë² ì´ë¼ ê°•ë³€ì˜ í™˜ìƒì ì¸ ì „ë§. ì£¼ì°¨ëŠ” ì œíœ´ ì£¼ì°¨ì¥ ì´ìš©.`, note: '5ì„±ê¸‰ / ì „ë§' },
                { id: 7, city: 'bilbao', type: 'food', name: 'Gure Toki', desc: `ëˆ„ì—ë°” ê´‘ì¥ì— ìœ„ì¹˜í•œ í˜ì‹ ì ì¸ í•€ì´ˆ ë°”ë¡œ í˜„ì§€ì¸ì—ê²Œ ì¸ê¸°.`, note: 'í•€ì´ˆ ë°”' },
                { id: 8, city: 'bilbao', type: 'food', name: 'La ViÃ±a del Ensanche', desc: `1927ë…„ë¶€í„° ì´ì–´ì§„ ì „í†µ ìˆëŠ” ë ˆìŠ¤í† ë‘. í•˜ëª½ê³¼ ì™€ì¸ì´ ìœ ëª….`, note: 'ì „í†µ/í•˜ëª½' },
                { id: 9, city: 'bilbao', type: 'stay', name: 'Gran Hotel Domine', desc: `êµ¬ê²í•˜ì„ ë¯¸ìˆ ê´€ ë§ì€í¸, ìµœê³ ì˜ ì „ë§ì„ ìë‘í•˜ëŠ” 5ì„±ê¸‰ í˜¸í…”. ì£¼ì°¨ ê°€ëŠ¥.`, note: '5ì„±ê¸‰ / ì „ë§' },
                { id: 10, city: 'bilbao', type: 'stay', name: 'Hotel MirÃ³', desc: `êµ¬ê²í•˜ì„ ê·¼ì²˜ì˜ ì„¸ë ¨ëœ ë””ìì¸ì„ ìë‘í•˜ëŠ” ë¶€í‹°í¬ í˜¸í…”. ì£¼ì°¨ ê°€ëŠ¥.`, note: '4ì„±ê¸‰ / ë””ìì¸' },
            ]
        };

        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.tab-btn');
            const contents = document.querySelectorAll('.content-section');
            const itineraryContainer = document.getElementById('itinerary-container');
            const prepAccordionContainer = document.getElementById('prep-accordion-container');
            const recommendContainer = document.getElementById('recommend-container');
            const filterBtns = document.querySelectorAll('.filter-btn');

            let weatherChartInstance, drivingTimeChartInstance, lisbonCardChartInstance, portoCardChartInstance, bilbaoCardChartInstance;

            function stripMarkdown(text) {
                if (!text) return '';
                let output = text;
                // Remove headers (e.g., #, ##)
                output = output.replace(/^#+\s*/gm, '');
                // Remove bold/italic markers but keep the text
                output = output.replace(/(\*\*|__)(.*?)\1/g, '$2'); // Bold
                output = output.replace(/(\*|_)(.*?)\1/g, '$2');   // Italic
                // Remove list markers (unordered) but keep the text
                output = output.replace(/^\s*[\*\-]\s/gm, '');
                // Remove links but keep the text
                output = output.replace(/\[([^\]]+)\]\([^\)]+\)/g, '$1');
                // Convert newlines to <br> for HTML display
                output = output.replace(/\n/g, '<br>');
                return output;
            }

            async function getGeminiResponse(prompt) {
                const apiKey = "AIzaSyACAoKxi4NsWm-zstIVpXLTh4apZmGz7Z0"; // ë³´ì•ˆì„ ìœ„í•´ ë¹„ì›Œë‘ê³ , ì‚¬ìš© ì‹œì ì— ì‹¤ì œ í‚¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) { return "ì£„ì†¡í•©ë‹ˆë‹¤. AI ì¶”ì²œì„ ê°€ì ¸ì˜¤ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."; }
                    const result = await response.json();
                    if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts) {
                        return result.candidates[0].content.parts[0].text;
                    } else { return "AIë¡œë¶€í„° ìœ íš¨í•œ ë‹µë³€ì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."; }
                } catch (error) { return "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë¡œ AI ì¶”ì²œì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."; }
            }

            function initTabs() {
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        tabs.forEach(item => { item.classList.remove('tab-active'); item.classList.add('tab-inactive'); });
                        tab.classList.add('tab-active'); tab.classList.remove('tab-inactive');
                        const target = tab.getAttribute('data-target');
                        contents.forEach(content => {
                            content.classList.remove('active');
                            if (content.id === target) { content.classList.add('active'); }
                        });
                        if (target === 'prep') { createWeatherChart(); createDrivingTimeChart(); }
                        else if (target === 'tips') { createLisbonCardChart(); createPortoCardChart(); createBilbaoCardChart(); }
                    });
                });
            }

            function createItinerary() {
                itineraryContainer.innerHTML = '';
                appData.itinerary.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'border border-stone-200 rounded-lg shadow-sm overflow-hidden bg-white';
                    card.innerHTML = `
                        <div class="p-4 flex justify-between items-center transition-colors duration-300 hover:bg-amber-50 cursor-pointer itinerary-header">
                            <div class="flex items-center">
                                <span class="text-xl font-bold text-amber-600 w-12 text-center">${item.day}ì¼ì°¨</span>
                                <div class="ml-4">
                                    <p class="font-semibold text-stone-800">${item.city}</p>
                                    <p class="text-sm text-stone-500">${item.theme}</p>
                                </div>
                            </div>
                            <span class="text-amber-600 transform transition-transform duration-300 expand-icon">&#9662;</span>
                        </div>
                        <div class="accordion-content">
                            <div class="p-4 border-t border-stone-200 bg-stone-50 text-stone-700">
                                <p>${item.details}</p>
                                <div class="mt-4">
                                    <button class="gemini-btn text-white text-sm font-bold py-2 px-3 rounded-md flex items-center get-activity-recommendation-btn" data-city="${item.cityForPrompt}" data-theme="${item.theme}">
                                        <span>âœ¨ AI í™œë™ ì¶”ì²œ</span>
                                        <div class="loader ml-2"></div>
                                    </button>
                                </div>
                                <div class="activity-recommendation-output mt-4 p-3 bg-white rounded-lg prose prose-sm max-w-none hidden"></div>
                            </div>
                        </div>
                    `;
                    itineraryContainer.appendChild(card);
                    
                    card.querySelector('.itinerary-header').addEventListener('click', () => {
                        const content = card.querySelector('.accordion-content');
                        const icon = card.querySelector('.expand-icon');
                        if (content.style.maxHeight) {
                            content.style.maxHeight = null; icon.style.transform = 'rotate(0deg)';
                        } else {
                            content.style.maxHeight = content.scrollHeight + 'px'; icon.style.transform = 'rotate(180deg)';
                        }
                    });

                    card.querySelector('.get-activity-recommendation-btn').addEventListener('click', async (e) => {
                        const button = e.currentTarget;
                        const loader = button.querySelector('.loader');
                        const outputDiv = card.querySelector('.activity-recommendation-output');
                        loader.style.display = 'inline-block'; button.disabled = true;
                        const city = button.dataset.city;
                        const theme = button.dataset.theme;
                        const prompt = `ì €ëŠ” 59ì„¸ í•œêµ­ì¸ ì—¬í–‰ìì…ë‹ˆë‹¤. í˜„ì¬ ${city}ì— ìˆìœ¼ë©°, ì˜¤ëŠ˜ì˜ ì—¬í–‰ í…Œë§ˆëŠ” '${theme}'ì…ë‹ˆë‹¤. ì´ í…Œë§ˆì— ë§ì¶°, ì—¬ìœ ë¡­ê³  ë¬¸í™”ì ìœ¼ë¡œ ê¹Šì´ ìˆëŠ” í™œë™ 2ê°€ì§€ë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”. ê° í™œë™ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ê³¼ ì™œ 50ëŒ€ ì—¬í–‰ìì—ê²Œ ì í•©í•œì§€ ì´ìœ ë¥¼ í¬í•¨í•´ì£¼ì„¸ìš”. ê²°ê³¼ëŠ” ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì„ ì‚¬ìš©í•˜ì§€ ë§ê³  ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ê°„ê²°í•˜ê²Œ ë³´ì—¬ì£¼ì„¸ìš”.`;
                        const result = await getGeminiResponse(prompt);
                        outputDiv.innerHTML = stripMarkdown(result);
                        outputDiv.style.display = 'block';
                        const content = card.querySelector('.accordion-content');
                        if (content.style.maxHeight) { content.style.maxHeight = content.scrollHeight + 'px'; }
                        loader.style.display = 'none'; button.disabled = false;
                    });
                });
            }
            
            function createPrepAccordion() {
                prepAccordionContainer.innerHTML = '';
                appData.prep.forEach(item => {
                    const accordion = document.createElement('div');
                    accordion.className = 'border border-stone-200 rounded-lg shadow-sm overflow-hidden bg-white';
                    accordion.innerHTML = `
                        <div class="p-4 flex justify-between items-center cursor-pointer transition-colors duration-300 hover:bg-amber-50">
                            <h3 class="text-lg font-semibold text-stone-800">${item.title}</h3>
                            <span class="text-amber-600 transform transition-transform duration-300">&#9662;</span>
                        </div>
                        <div class="accordion-content">
                             <div class="p-4 border-t border-stone-200 bg-stone-50 text-stone-700">
                                ${item.content}
                            </div>
                        </div>
                    `;
                    prepAccordionContainer.appendChild(accordion);
                    accordion.querySelector('.p-4').addEventListener('click', () => {
                        const content = accordion.querySelector('.accordion-content');
                        const icon = accordion.querySelector('.text-amber-600.transform');
                        if (content.style.maxHeight) {
                            content.style.maxHeight = null; icon.style.transform = 'rotate(0deg)';
                        } else {
                            content.style.maxHeight = content.scrollHeight + 'px'; icon.style.transform = 'rotate(180deg)';
                        }
                    });
                });
            }

            function createRecommendations() {
                recommendContainer.innerHTML = '';
                appData.recommendations.forEach(item => {
                    let borderColor, textColor;
                    if (item.city === 'lisbon') { borderColor = 'border-amber-500'; textColor = 'text-amber-700';
                    } else if (item.city === 'porto') { borderColor = 'border-blue-500'; textColor = 'text-blue-700';
                    } else if (item.city === 'aveiro') { borderColor = 'border-green-500'; textColor = 'text-green-700';
                    } else { borderColor = 'border-red-500'; textColor = 'text-red-700'; }

                    const card = document.createElement('div');
                    card.className = `recommendation-card border-l-4 ${borderColor} bg-white p-4 rounded-lg shadow-md transition-transform duration-300 hover:scale-105`;
                    card.dataset.filter = `${item.city}-${item.type}`;
                    if(item.city === 'aveiro') card.dataset.filter = 'aveiro-all';

                    card.innerHTML = `
                        <div class="flex justify-between items-start">
                             <h4 class="text-lg font-bold text-stone-800">${item.name}</h4>
                             <span class="text-xs font-semibold ${textColor} bg-opacity-20 ${borderColor.replace('500', '100').replace('border-','bg-')} py-1 px-2 rounded-full">${item.note}</span>
                        </div>
                        <p class="text-stone-600 mt-2">${item.desc}</p>
                    `;
                    recommendContainer.appendChild(card);
                });
            }
            
            function initFoodRecommendation() {
                const button = document.getElementById('get-food-recommendation-btn');
                const input = document.getElementById('food-preference-input');
                const outputDiv = document.getElementById('food-recommendation-output');
                const loader = button.querySelector('.loader');
                button.addEventListener('click', async () => {
                    const preference = input.value.trim();
                    if (!preference) {
                        outputDiv.innerHTML = "ë¨¼ì € ì›í•˜ëŠ” ìŒì‹ì´ë‚˜ ì‹ë‹¹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                        outputDiv.style.display = 'block'; return;
                    }
                    loader.style.display = 'inline-block'; button.disabled = true;
                    const prompt = `You are a helpful local guide for a 59-year-old Korean traveler in Portugal or Northern Spain. The traveler wants to find a restaurant. Based on their search query, recommend 1-2 specific, real restaurants. For each recommendation, provide the restaurant's name and a brief, appealing description of why it's a good choice. The traveler's search query is: '${preference}'. Respond in Korean. Crucially, your entire response must be plain text without any Markdown formatting (do not use *, #, **, etc.).`;
                    const result = await getGeminiResponse(prompt);
                    outputDiv.innerHTML = stripMarkdown(result);
                    outputDiv.style.display = 'block';
                    loader.style.display = 'none'; button.disabled = false;
                });
            }

            function initFilters() {
                filterBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const filter = btn.dataset.filter;
                        const allCards = document.querySelectorAll('.recommendation-card');
                        filterBtns.forEach(b => { b.classList.remove('bg-amber-600', 'text-white'); b.classList.add('bg-white'); });
                        btn.classList.add('bg-amber-600', 'text-white'); btn.classList.remove('bg-white');
                        allCards.forEach(card => {
                            if (filter === 'all' || card.dataset.filter === filter || card.dataset.filter.startsWith(filter)) {
                                card.style.display = 'block';
                            } else { card.style.display = 'none'; }
                        });
                    });
                });
            }

            const chartOptions = { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: true } } };
            
            function createWeatherChart() {
                if (weatherChartInstance) return;
                const ctx = document.getElementById('weatherChart').getContext('2d');
                weatherChartInstance = new Chart(ctx, { type: 'bar', data: {
                        labels: ['ë¦¬ìŠ¤ë³¸', 'í¬ë¥´íˆ¬', 'ë¹Œë°”ì˜¤'],
                        datasets: [
                            { label: 'í‰ê·  ìµœê³ ê¸°ì˜¨ (Â°C)', data: [28, 24, 23], backgroundColor: 'rgba(255, 159, 64, 0.6)'},
                            { label: 'í‰ê·  ìµœì €ê¸°ì˜¨ (Â°C)', data: [20, 14, 14], backgroundColor: 'rgba(54, 162, 235, 0.6)'}
                        ]
                    }, options: chartOptions });
            }

            function createDrivingTimeChart() {
                if (drivingTimeChartInstance) return;
                const ctx = document.getElementById('drivingTimeChart').getContext('2d');
                drivingTimeChartInstance = new Chart(ctx, { type: 'bar', data: {
                        labels: ['ë¦¬ìŠ¤ë³¸ â†’ ì•„ë² ì´ë£¨', 'ì•„ë² ì´ë£¨ â†’ í¬ë¥´íˆ¬'],
                        datasets: [
                            { label: 'ì˜ˆìƒ ìš´ì „ ì‹œê°„ (ì‹œê°„)', data: [2.5, 1], backgroundColor: 'rgba(75, 192, 192, 0.6)' }
                        ]
                    }, options: chartOptions });
            }
            
            const doughnutOptions = { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } };

            function createLisbonCardChart() {
                if (lisbonCardChartInstance) return;
                const ctx = document.getElementById('lisbonCardChart').getContext('2d');
                lisbonCardChartInstance = new Chart(ctx, { type: 'doughnut', data: {
                        labels: ['ë¦¬ìŠ¤ë³¸ ì¹´ë“œ (48h)', 'ê°œë³„ êµ¬ë§¤ ì‹œ ì˜ˆìƒ ë¹„ìš©'],
                        datasets: [{ data: [47, 40], backgroundColor: ['rgba(255, 206, 86, 0.7)', 'rgba(217, 119, 6, 0.7)'], hoverOffset: 4 }]
                    }, options: doughnutOptions });
            }

            function createPortoCardChart() {
                if (portoCardChartInstance) return;
                 const ctx = document.getElementById('portoCardChart').getContext('2d');
                 portoCardChartInstance = new Chart(ctx, { type: 'doughnut', data: {
                        labels: ['í¬ë¥´íˆ¬ ì¹´ë“œ+êµí†µ (48h)', 'êµí†µì¹´ë“œ+ê°œë³„ êµ¬ë§¤ ì‹œ ì˜ˆìƒ'],
                        datasets: [{ data: [20, 18], backgroundColor: ['rgba(153, 102, 255, 0.7)', 'rgba(54, 162, 235, 0.7)'], hoverOffset: 4 }]
                    }, options: doughnutOptions });
            }
            
            function createBilbaoCardChart() {
                if (bilbaoCardChartInstance) return;
                 const ctx = document.getElementById('bilbaoCardChart').getContext('2d');
                 bilbaoCardChartInstance = new Chart(ctx, { type: 'doughnut', data: {
                        labels: ['ë¹Œë°”ì˜¤ ì¹´ë“œ (48h)', 'ê°œë³„ êµ¬ë§¤ ì‹œ ì˜ˆìƒ ë¹„ìš©'],
                        datasets: [{ data: [35, 42], backgroundColor: ['rgba(239, 68, 68, 0.7)', 'rgba(217, 119, 6, 0.7)'], hoverOffset: 4 }]
                    }, options: doughnutOptions });
            }
            
            initTabs();
            createItinerary();
            createPrepAccordion();
            createRecommendations();
            initFilters();
            initFoodRecommendation();
        });
    </script>
</body>
</html>
